<?php
/**
* This is a very simple leadbaord for Construct2. I love the freedom that
* allows me to write this awful code.  
*
* @version 0,1
* @copyright mmmm
* @link http://htejera.ukelelestudio.com
*/

//Permissive mode
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Access-Control-Allow-Origin');

$f3=require('lib/base.php');
$f3->set('AUTOLOAD', 'app/;app/inc/');
$f3->set('DEBUG',3);

//TODO: Move this to a config file or something like that
$f3->set('maxScoreAllowed', 6000);
$f3->set('magicNumber', 3);

$db=new DB\SQL('sqlite:integers.sqlite');
$f3->set('db',$db);

$leaderboard=Leaderboard::instance();

$sanidad=Sanidad::instance();
$f3->set('sanidad',$sanidad);

$construct2=Json2Construct2::instance();
$f3->set('construct2',$construct2);

$util=Utils::instance();
$f3->set('util',$util);

//Routing
$f3->route('GET /addscore/@game/@key/@playername/@score','leaderboard->addScore');
$f3->route('GET /getlastrank/@game/@playername','leaderboard->getLastRank');
$f3->route('GET /getbestrank/@game/@playername','leaderboard->getBestRank');
$f3->route('GET /topscores/@game','leaderboard->topScores');
$f3->set('ONERROR',
    function($f3) {        
        echo json_encode($f3->get('ERROR.text'));
    }
);
$f3->run();
